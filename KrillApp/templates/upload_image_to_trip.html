<!-- templates/ImagesView.html -->
{% extends 'base.html' %}

{% load static %}
{% load crispy_forms_tags %}

{% block javascript %}
  <script src="{% static 'KrillApp/Javascript/jquery.ui.widget.js' %}"></script>
  <script src="{% static 'KrillApp/Javascript/jquery.iframe-transport.js' %}"></script>
  <script src="{% static 'KrillApp/Javascript/jquery.fileupload.js' %}"></script>
  <script src="{% static 'KrillApp/Javascript/basic-upload.js' %}"></script>
  {% endblock %}

{% block content %}

<!--
<div class="center">
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form|crispy}}
    <button type="submit">Upload</button>
  </form>
  
  <input id="fileupload" type="file" name="file" multiple
    style="display: none;"
    data-url="{% url 'basic_upload' %}"
    data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'>
-->

  
  <div class="center">


  
        
  <select id ="trip_list" >
    {% for trip in trips %}
        <option value="{{ trip }}">{{ trip }}</option>
    {% endfor %}
    </select>

    <div id="fileupload" style:"display:inline">
      <form action="{% url 'basic_upload' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="fileupload-buttonbar">

                  <input type="file" name="image_file" multiple>



          </div>
      </form>

  </div>









  <table id="gallery" class="table table-bordered">
    <thead>
      <tr>
        <th>Uploaded Photos</th>
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
</div>

<script type="text/javascript">
$('#fileupload').fileupload({

    formData: [
          { name: "csrfmiddlewaretoken", value: "{{ csrf_token }}"},

      ],
      done: function (e, data) {  /* 3. PROCESS THE RESPONSE FROM THE SERVER */
    if (data.result.is_valid) {
      DJANGO_STATIC_URL = '{{MEDIA_URL}}';
      $("#gallery tbody").prepend(
        "<tr><td><a href='" + DJANGO_STATIC_URL + data.result.url + "'>" + data.result.url +"</a></td></tr>"
      )
    }
  }
  });

  $('#fileupload').bind('fileuploadsubmit', function (e, data) {
    // The example input, doesn't have to be part of the upload form:
    var input = $('#trip_list').val();
    data.formData = [
    { name: "csrfmiddlewaretoken", value: "{{ csrf_token }}"},
    { name: "trip_name", value: input}
    ]

    
});


  </script>



{% endblock %}